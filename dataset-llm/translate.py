from typing import List, Callable

from keybert import KeyBERT
from keyphrase_vectorizers import KeyphraseCountVectorizer
from sentence_transformers import SentenceTransformer

from chunkey_bert.model import ChunkeyBert
import re

sentence_model: SentenceTransformer = SentenceTransformer(model_name_or_path="all-MiniLM-L6-v2")
keybert: KeyBERT = KeyBERT(model=sentence_model)
keyphrase_vectorizer: KeyphraseCountVectorizer = KeyphraseCountVectorizer(spacy_pipeline="en_core_web_trf")

chunkey_bert: ChunkeyBert = ChunkeyBert(keybert=keybert)
chunker: Callable[[str], List[str]] = lambda text: [t for t in text.split("\n\n") if len(t) > 25]
chunker_leestekens: Callable[[str], List[str]] = lambda text: [t for t in re.split("\.|\?|!", text) if len(t) > 25]
text = """
Anarchism is a political philosophy and movement that is sceptical of authority and rejects all involuntary, coercive forms of hierarchy. Anarchism calls for the abolition of the state, which it holds to be unnecessary, undesirable, and harmful. As a historically left-wing movement, placed on the farthest left of the political spectrum, it is usually described alongside communalism and libertarian Marxism as the libertarian wing (libertarian socialism) of the socialist movement, and has a strong historical association with anti-capitalism and socialism.\n\nHumans lived in societies without formal hierarchies long before the establishment of formal states, realms, or empires. With the rise of organised hierarchical bodies, scepticism toward authority also rose. Although traces of anarchist thought are found throughout history, modern anarchism emerged from the Enlightenment. During the latter half of the 19th and the first decades of the 20th century, the anarchist movement flourished in most parts of the world and had a significant role in workers\' struggles for emancipation. Various anarchist schools of thought formed during this period. Anarchists have taken part in several revolutions, most notably in the Paris Commune, the Russian Civil War and the Spanish Civil War, whose end marked the end of the classical era of anarchism. In the last decades of the 20th and into the 21st century, the anarchist movement has been resurgent once more.\n\nAnarchism employs a diversity of tactics in order to meet its ideal ends which can be broadly separated into revolutionary and evolutionary tactics; there is significant overlap between the two, which are merely descriptive. Revolutionary tactics aim to bring down authority and state, having taken a violent turn in the past, while evolutionary tactics aim to prefigure what an anarchist society would be like. Anarchist thought, criticism, and praxis have played a part in diverse areas of human society. Criticism of anarchism include claims that it is internally inconsistent, violent, or utopian.\n\nEtymology, terminology, and definition \n\nThe etymological origin of anarchism is from the Ancient Greek anarkhia, meaning "without a ruler", composed of the prefix an- ("without") and the word arkhos ("leader" or "ruler"). The suffix -ism denotes the ideological current that favours anarchy. Anarchism appears in English from 1642 as anarchisme and anarchy from 1539; early English usages emphasised a sense of disorder. Various factions within the French Revolution labelled their opponents as anarchists, although few such accused shared many views with later anarchists. Many revolutionaries of the 19th century such as William Godwin (1756–1836) and Wilhelm Weitling (1808–1871) would contribute to the anarchist doctrines of the next generation but did not use anarchist or anarchism in describing themselves or their beliefs.\n\nThe first political philosopher to call himself an anarchist () was Pierre-Joseph Proudhon (1809–1865), marking the formal birth of anarchism in the mid-19th century. Since the 1890s and beginning in France, libertarianism has often been used as a synonym for anarchism and its use as a synonym is still common outside the United States. Some usages of libertarianism refer to individualistic free-market philosophy only, and free-market anarchism in particular is termed libertarian anarchism.\n\nWhile the term libertarian has been largely synonymous with anarchism, its meaning has more recently diluted with wider adoption from ideologically disparate groups, including both the New Left and libertarian Marxists, who do not associate themselves with authoritarian socialists or a vanguard party, and extreme cultural liberals, who are primarily concerned with civil liberties. Additionally, some anarchists use libertarian socialist to avoid anarchism\'s negative connotations and emphasise its connections with socialism. Anarchism is broadly used to describe the anti-authoritarian wing of the socialist movement. Anarchism is contrasted to socialist forms which are state-oriented or from above. Scholars of anarchism generally highlight anarchism\'s socialist credentials and criticise attempts at creating dichotomies between the two. Some scholars describe anarchism as having many influences from liberalism, and being both liberals and socialists but more so, while most scholars reject anarcho-capitalism as a misunderstanding of anarchist principles.
"""

text = """
Home / News / Vlaams Belang Antwerp condemns riots and holds Moroccan community responsible for violence and vandalism Share this article Vlaams Belang Antwerp condemns riots and holds Moroccan community responsible for violence and vandalism 28 November 2022 Local @ Vlaams Belang Vlaams Belang condemns riots and holds Moroccan community responsible for violence and vandalism Filip Dewinter: “Antwerp has a Moroccan problem” Vlaams Belang Antwerp strongly condemns the riots that took place in Antwerp last night after the Belgium-Morocco match. The fact that these were not isolated incidents of “individuals” is proven by the fact that there were riots in Borgerhout, Antwerp-North and on the Kiel. In contrast to Brussels, the Antwerp police took decisive action, which prevented the riots from spreading to the rest of the city. Antwerp city councillor Filip Dewinter, who will question mayor Bart De Wever about the facts tomorrow during the city council, believes that the incidents should not be downplayed in a politically correct way: "It is about much more than an out-of-control afterparty or a frenzy of frustrated young people. It concerns a violent resistance against any form of integration and naturalisation and is an aggressive affirmation of the Moroccan identity. A confrontation with the government, the country and the people where this Moroccan community lives, works and lives." Filip Dewinter: "How symbolic are the images of a large cheering crowd on the Turnhoutsebaan where a Moroccan climbs two floors high to take down a flag of the Red Devils and then ostentatiously waves a Moroccan flag. The failure of integration cannot be illustrated better. This reverse form of colonisation must come to an end." According to Antwerp bigwig Filip Dewinter, it has long ceased to be about isolated incidents: “The response to the riots is not just a matter of maintaining public order. This is about culturally and socially inappropriate behavior, carried out by a significant part of the Moroccan community, about the failed immigration policy and about a violent takeover of neighborhoods and districts of our city. In Antwerp - just like in many other major cities in our country and Europe - there is a Moroccan problem.” The answer is not just more police, stricter punishments and a firm approach, but a policy of adapting or getting out. Luc Doms Press Officer Vlaams Belang Antwerp Share this article Newsletter Subscribe for free to the latest news from Vlaams Belang! Subscribe » Become a member of Vlaams Belang Become a member and support Vlaams Belang! Become a Member »
"""

results = chunker_leestekens(text)
print(f"aantal chunks: {len(results)}")
print(chunker_leestekens(text))

print(
chunkey_bert.extract_keywords(
    docs=text, num_keywords=5, chunker=chunker_leestekens, vectorizer=keyphrase_vectorizer, nr_candidates=10, top_n=3
)
)
# print(chunkey_bert.extract_keywords(docs=text, num_keywords=5, vectorizer=keyphrase_vectorizer, nr_candidates=20, top_n=10))